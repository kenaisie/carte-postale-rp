<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carte Postale RP — Créateur</title>

  <!-- Fonts from Zealandia -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Playfair+Display:wght@400;700&family=Cormorant+Garamond&family=Homemade+Apple&display=swap" rel="stylesheet">

  <style>
    :root{--bg:#f3efe6;}
    *{box-sizing:border-box;}
    body{
      font-family:"Playfair Display",serif;
      background:var(--bg);
      margin:0;
      color:#222;
      padding:18px;
    }

    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:20px}
    .wrap{max-width:1200px;margin:18px auto}

    .controls{display:grid;grid-template-columns:320px 1fr;gap:18px;margin-top:18px}
    .panel{
      background:#fff;
      padding:14px;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(0,0,0,.06)
    }
    label{display:block;font-size:13px;margin-top:8px}
    input[type=text], select, textarea{
      width:100%;
      padding:8px;
      border-radius:6px;
      border:1px solid #ddd;
      font-size:14px
    }
    button{
      padding:10px 12px;
      border-radius:8px;
      border:0;
      background:#2f5d3b;
      color:#fff;
      font-weight:600;
      cursor:pointer
    }
    small{color:#666}

    /* postcard styles (from functional code) */
    .postcard{
      width:640px;
      height:400px;
      perspective:1200px;
      position:relative;
      margin:auto;
    }
    .inner{
      width:100%;
      height:100%;
      transform-style:preserve-3d;
      transition:transform .8s;
      position:relative;
    }
    .postcard.flipped .inner{transform:rotateY(180deg);}
    .face{
      position:absolute;
      width:100%;
      height:100%;
      backface-visibility:hidden;
      border-radius:6px;
      box-shadow:0 4px 10px rgba(0,0,0,.3);
      overflow:hidden;
    }
    .front{
      background:url("https://upload.wikimedia.org/wikipedia/commons/6/63/Postcard_front_sample.jpg") center/cover no-repeat;
    }
    .back{
      transform:rotateY(180deg);
      background:#f3efe6;
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      padding:30px;
    }
    .back::before{
      content:'';
      position:absolute;
      inset:0;
      background-image:var(--verso-img);
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      opacity:.35;
      z-index:0;
    }
    textarea{
      flex:1;
      resize:none;
      border:none;
      background:transparent;
      font-family:"Homemade Apple",cursive;
      font-size:20px;
      line-height:1.5;
      z-index:2;
      position:relative;
    }
    textarea:focus{outline:none;}
    .drawCanvas{
      position:absolute;
      inset:0;
      z-index:2;
      cursor:crosshair;
    }
    .previewWrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Zealandia Post Offices</h1>
      <div><small>What could be nicer than sending a pretty postcard of your adventures to a loved one?</small></div>
    </header>

    <div class="controls">
      <div class="panel">
        <h3>Options de création</h3>

        <label>Image verso</label>
        <input type="file" id="uploadVerso" accept="image/*">

        <label>Mode d'écriture</label>
        <select id="mode">
          <option value="typed">Texte</option>
          <option value="handwrite">Manuel</option>
        </select>

        <label>Texte du message</label>
        <textarea id="textArea" rows="4" placeholder="Mon cher ami,&#10;Je t'écris depuis la gare..."></textarea>

        <div style="margin-top:10px;display:flex;gap:8px;">
          <button id="flipBtn">Retourner</button>
          <button id="saveBtn">Télécharger</button>
        </div>
      </div>

      <div class="panel previewWrap">
        <!-- postcard from working code -->
        <div class="postcard" id="postcard">
          <div class="inner">
            <div class="face front" id="frontFace"></div>
            <div class="face back" id="backFace">
              <canvas class="drawCanvas" id="drawCanvas"></canvas>
              <textarea id="textAreaDisplay" placeholder="Écris ton message ici..."></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const card=document.getElementById('postcard');
const inner=card.querySelector('.inner');
const back=document.getElementById('backFace');
const canvas=document.getElementById('drawCanvas');
const ctx=canvas.getContext('2d');
const textareaDisplay=document.getElementById('textAreaDisplay');
const textareaInput=document.getElementById('textArea');
let drawing=false,lastX=0,lastY=0;
let mode='typed';

/* --- canvas setup --- */
function resizeCanvas(){
  canvas.width=back.clientWidth;
  canvas.height=back.clientHeight;
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();
ctx.strokeStyle='#1e1b16';
ctx.lineWidth=2;
ctx.lineCap='round';

/* --- drawing --- */
canvas.addEventListener('mousedown',e=>{
  if(mode!=='handwrite')return;
  drawing=true;
  [lastX,lastY]=[e.offsetX,e.offsetY];
});
canvas.addEventListener('mousemove',e=>{
  if(!drawing||mode!=='handwrite')return;
  ctx.beginPath();
  ctx.moveTo(lastX,lastY);
  ctx.lineTo(e.offsetX,e.offsetY);
  ctx.stroke();
  [lastX,lastY]=[e.offsetX,e.offsetY];
});
['mouseup','mouseleave'].forEach(ev=>canvas.addEventListener(ev,()=>drawing=false));

/* --- controls --- */
document.getElementById('flipBtn').onclick=()=>card.classList.toggle('flipped');

document.getElementById('mode').onchange=e=>{
  mode=e.target.value;
  textareaDisplay.style.display=mode==='typed'?'block':'none';
  canvas.style.pointerEvents=mode==='handwrite'?'auto':'none';
};

/* --- sync typed text --- */
textareaInput.addEventListener('input',()=>{
  textareaDisplay.value=textareaInput.value;
});

/* --- upload background --- */
document.getElementById('uploadVerso').addEventListener('change',ev=>{
  const f=ev.target.files[0];
  if(!f)return;
  const url=URL.createObjectURL(f);
  back.style.setProperty('--verso-img',`url('${url}')`);
});

/* --- export --- */
document.getElementById('saveBtn').onclick=()=>{
  const link=document.createElement('a');
  link.href=canvas.toDataURL('image/png');
  link.download='carte_postale.png';
  link.click();
};
</script>
</body>
</html>
